!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){var s,n,r={},a=(s=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===n&&(n=s.apply(this,arguments)),n}),o=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var i=function(t){return document.querySelector(t)}.call(this,t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}}(),h=null,l=0,d=[],c=i(5);function m(t,e){for(var i=0;i<t.length;i++){var s=t[i],n=r[s.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++)n.parts[a](s.parts[a]);for(;a<s.parts.length;a++)n.parts.push(y(s.parts[a],e))}else{var o=[];for(a=0;a<s.parts.length;a++)o.push(y(s.parts[a],e));r[s.id]={id:s.id,refs:1,parts:o}}}}function p(t,e){for(var i=[],s={},n=0;n<t.length;n++){var r=t[n],a=e.base?r[0]+e.base:r[0],o={css:r[1],media:r[2],sourceMap:r[3]};s[a]?s[a].parts.push(o):i.push(s[a]={id:a,parts:[o]})}return i}function u(t,e){var i=o(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var s=d[d.length-1];if("top"===t.insertAt)s?s.nextSibling?i.insertBefore(e,s.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),d.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var n=o(t.insertInto+" "+t.insertAt.before);i.insertBefore(e,n)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function f(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),v(e,t.attrs),u(t,e),e}function v(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})}function y(t,e){var i,s,n,r;if(e.transform&&t.css){if(!(r=e.transform(t.css)))return function(){};t.css=r}if(e.singleton){var a=l++;i=h||(h=f(e)),s=x.bind(null,i,a,!1),n=x.bind(null,i,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",v(e,t.attrs),u(t,e),e}(e),s=function(t,e,i){var s=i.css,n=i.sourceMap,r=void 0===e.convertToAbsoluteUrls&&n;(e.convertToAbsoluteUrls||r)&&(s=c(s));n&&(s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var a=new Blob([s],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(a),o&&URL.revokeObjectURL(o)}.bind(null,i,e),n=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=f(e),s=function(t,e){var i=e.css,s=e.media;s&&t.setAttribute("media",s);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),n=function(){g(i)});return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else n()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=p(t,e);return m(i,e),function(t){for(var s=[],n=0;n<i.length;n++){var a=i[n];(o=r[a.id]).refs--,s.push(o)}t&&m(p(t,e),e);for(n=0;n<s.length;n++){var o;if(0===(o=s[n]).refs){for(var h=0;h<o.parts.length;h++)o.parts[h]();delete r[o.id]}}}};var b,w=(b=[],function(t,e){return b[t]=e,b.filter(Boolean).join("\n")});function x(t,e,i,s){var n=i?"":s.css;if(t.styleSheet)t.styleSheet.cssText=w(e,n);else{var r=document.createTextNode(n),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",s=t[3];if(!s)return i;if(e&&"function"==typeof btoa){var n=(a=s,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),r=s.sources.map(function(t){return"/*# sourceURL="+s.sourceRoot+t+" */"});return[i].concat(r).concat([n]).join("\n")}var a;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var s={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(s[r]=!0)}for(n=0;n<t.length;n++){var a=t[n];"number"==typeof a[0]&&s[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),e.push(a))}},e}},function(t,e,i){"use strict";i.r(e);class s{constructor(t,e,i,s,n,r,a,o=0,h=1,l=!0){this.canvas=t,this.canvasContext=this.canvas.getContext("2d"),this.url=e,this.imageWidth=i,this.imageHeight=s,this.imagePosition=n,this.spritePosition=a,this.spriteSize=r,this.imageReverse=!1,this.framesPerSecond=15,this.speed=15,this.startWaitingTime=Date.now(),this.animationDelay=o,this.animationTime=0,this.lastRenderingTime=Date.now(),this.framesAmount=h,this.spriteDirectionReverse=!1,this.spriteDirectionChangeable=!1,this.spriteRepeat=l,this.isMoving=!1}renderImage(){const t=new Image;t.src=this.url,this.delayInterval=this.getTimeInterval(this.startWaitingTime,Date.now()),this.isMoving&&this.moveToPosition();const e=this.imageWidth*(1-(this.canvas.height-this.imagePosition[1])/2500),i=this.imageHeight*(1-(this.canvas.height-this.imagePosition[1])/2500);this.isAnimationStarted()&&this.isFramesCycling()&&(this.animationTime=this.getTimeInterval(this.lastRenderingTime+this.animationDelay,Date.now()),this.changeSpritePosition()),this.canvasContext.save(),this.imageReverse&&this.canvasContext.scale(-1,1),this.canvasContext.drawImage(t,this.spritePosition[0],this.spritePosition[1],this.spriteSize[0],this.spriteSize[1],this.getImageXPosition(),this.imagePosition[1],e,i),this.canvasContext.restore()}isAnimationStarted(){return this.delayInterval>this.animationDelay}isImageReverse(t){return 0===t?this.imageReverse:t<0}getImageXPosition(){return this.imageReverse?-this.imagePosition[0]-this.imageWidth:this.imagePosition[0]}setImagePosition(t,e,i,s,n,r){this.imagePosition[0]+=t,this.imagePosition[1]+=e,i&&(this.imagePosition[1]<r+49&&(i=420),this.imagePosition[0]<n?this.imagePosition[0]=n:this.imagePosition[0]+this.imageWidth>i&&(this.imagePosition[0]=i-this.imageWidth),this.imagePosition[0]>420-this.imageWidth&&(r+=65),this.imagePosition[1]<r?this.imagePosition[1]=r:this.imagePosition[1]+this.imageHeight>s&&(this.imagePosition[1]=s-this.imageHeight))}changeSpritePosition(){this.spriteDirectionReverse?this.spritePosition[0]=this.spriteSize[0]*(this.framesAmount-Math.ceil(this.framesPerSecond*this.animationTime/1e3)):this.spritePosition[0]=this.spriteSize[0]*Math.floor(this.framesPerSecond*this.animationTime/1e3),this.isFramesCycleEnded()&&this.spriteRepeat?(!this.spriteDirectionReverse&&this.spriteDirectionChangeable||this.spriteDirectionReverse&&!this.spriteDirectionChangeable?this.spritePosition[0]=this.spriteSize[0]*(this.framesAmount-1):this.spritePosition[0]=0,this.spriteDirectionChangeable&&this.changeSpriteDirection(),this.startWaitingTime=Date.now(),this.lastRenderingTime=Date.now()):this.isFramesCycleEnded()&&!this.spriteRepeat&&(this.spritePosition[0]=this.spriteSize[0]*(this.framesAmount-1))}isFramesCycling(){return this.framesAmount>1}isFramesCycleEnded(){return this.spritePosition[0]>=this.spriteSize[0]*this.framesAmount||this.spritePosition[0]<0}getTimeInterval(t,e){return e-t}changeSpriteDirection(){this.spriteDirectionReverse=!this.spriteDirectionReverse}moveToPosition(){const t=this.finalPosition[0]-this.imagePosition[0],e=this.finalPosition[1]-this.imagePosition[1],i=Math.sqrt(Math.pow(t,2),Math.pow(e,2)),s=t/(i/this.speed),n=e/(i/this.speed);Math.floor(i)>this.speed?this.setImagePosition(s,n):this.isMoving=!1}move(t){this.finalPosition=t,this.isMoving=!0}}class n extends s{constructor(t,e,i,s,n,r,a,o,h,l,d,c,m,p,u){super(s,n,h,l,r,m,p,d,u,c),this.name=t,this.appearance=e,this.state=a,this.stateAction=o,this.healthPoints=i}setState(t){this.stateAction!==t.action&&(this.stateAction=t.action,this.imageWidth=t.imageSize[0],this.imageHeight=t.imageSize[1],this.spritePosition=t.firstSpritePosition.slice(),this.spriteSize=t.spriteSize.slice(),this.framesAmount=t.framesAmount,this.animationDelay=t.animationDelay,this.spriteRepeat=t.repeat,this.spriteRepeat?this.framesPerSecond=15:this.framesPerSecond=8)}setHealthPoints(t){0!==t&&(this.healthPoints+=t/Math.abs(t),setTimeout(()=>{this.setHealthPoints(t-t/Math.abs(t)),this.healthPoints<0?this.healthPoints=0:this.healthPoints>this.maxHealth&&(this.healthPoints=this.maxHealth)},10))}}const r=new Map([["stay",{action:"stay",imageSize:[65,95],spriteSize:[125,185],firstSpritePosition:[0,0],framesAmount:7,animationDelay:2e3,repeat:!0}],["run",{action:"run",imageSize:[75,95],spriteSize:[145,185],firstSpritePosition:[0,185],framesAmount:14,animationDelay:0,repeat:!0}],["aim",{action:"aim",imageSize:[65,95],spriteSize:[130,185],firstSpritePosition:[0,370],framesAmount:12,animationDelay:0,repeat:!0}],["hit",{action:"hit",imageSize:[95,95],spriteSize:[185,185],firstSpritePosition:[0,555],framesAmount:8,animationDelay:0,repeat:!1}],["miss",{action:"miss",imageSize:[95,95],spriteSize:[185,185],firstSpritePosition:[0,740],framesAmount:13,animationDelay:0,repeat:!1}],["take",{action:"take",imageSize:[85,95],spriteSize:[170,185],firstSpritePosition:[0,925],framesAmount:9,animationDelay:0,repeat:!1}],["boom",{action:"boom",imageSize:[95,95],spriteSize:[190,190],firstSpritePosition:[0,1110],framesAmount:13,animationDelay:0,repeat:!1}]]),a=new Map([["firstName",["Злой","Коварный","Хитрый"]],["surname",["Разбойник","Охотник","Пират"]],["lastName",["Кряк","Шмяк","Рекс","Кекс"]]]),o=new Map([["stay",{action:"stay",imageSize:[75,75],spriteSize:[150,150],animationDelay:1500,repeat:!0}]]),h=new Map([["head",[{firstSpritePosition:[0,0],framesAmount:4},{firstSpritePosition:[0,150],framesAmount:2},{firstSpritePosition:[0,300],framesAmount:3},{firstSpritePosition:[0,450],framesAmount:3}]],["body",[{firstSpritePosition:[0,600],framesAmount:1},{firstSpritePosition:[150,600],framesAmount:1},{firstSpritePosition:[300,600],framesAmount:1}]],["legs",[{firstSpritePosition:[0,750],framesAmount:1},{firstSpritePosition:[150,750],framesAmount:1},{firstSpritePosition:[300,750],framesAmount:1}]],["weapon",[{firstSpritePosition:[0,900],framesAmount:1},{firstSpritePosition:[150,900],framesAmount:1},{firstSpritePosition:[300,900],framesAmount:1}]]]),l=new Map([["Взрывной удар",{id:0,name:"Взрывной удар",heal:!1,url:"images/breath.png",audio:"audio/explosion.ogg",imageSize:[120,120],spriteSize:[115,115],firstSpritePosition:[0,115],framesAmount:5,speed:15,animationDelay:0,repeat:!0}],["Удар молнии",{id:1,name:"Удар молнии",heal:!1,url:"images/lightning.png",audio:"audio/thunder.ogg",imageSize:[130,250],spriteSize:[130,250],firstSpritePosition:[0,0],framesAmount:8,speed:10,animationDelay:0,repeat:!0}],["Лечение",{id:2,name:"Лечение",heal:!0,url:"images/heal.png",audio:"audio/heal.ogg",imageSize:[120,120],spriteSize:[60,60],firstSpritePosition:[0,0],framesAmount:5,speed:10,animationDelay:0,repeat:!0}]]),d=new Map([["aim",{url:"images/castSpell.png",imageSize:[65,65],spriteSize:[135,135],firstSpritePosition:[0,0],framesAmount:5,speed:10,animationDelay:0,repeat:!0}],["success",{url:"images/castSpell.png",imageSize:[65,65],spriteSize:[135,135],firstSpritePosition:[0,135],framesAmount:5,speed:10,animationDelay:0,repeat:!0}],["failure",{url:"images/castSpell.png",imageSize:[65,65],spriteSize:[135,135],firstSpritePosition:[0,270],framesAmount:5,speed:10,animationDelay:0,repeat:!0}],["hit",{url:"images/castSpell.png",imageSize:[270,270],spriteSize:[135,135],firstSpritePosition:[0,405],framesAmount:5,speed:6,animationDelay:100,repeat:!0}]]);class c extends n{constructor(...t){super(...t),this.speed=6,this.pressedButtons={up:!1,right:!1,down:!1,left:!1,amount:0},this.maxHealth=100,this.time=Date.now()}renderImage(){if(this.pressedButtons.amount>0){const t=this.getImageShiftX(),e=this.getImageShiftY();if(this.imageReverse=this.isImageReverse(t),"run"!==this.stateAction&&this.setState("run"),Date.now()-this.time>550){const t=new Audio("audio/step.wav");t.volume=.4,t.play(),this.time=Date.now()}const i=this.canvas.width,s=this.canvas.height,n=0,r=220;this.setImagePosition(t,e,i,s,n,r)}super.renderImage()}handleInput(t){const e=t.keyCode,i=this.getButtonDirection(e);37!==e&&38!==e&&39!==e&&40!==e||this.addPressedButtons(i)}getButtonDirection(t){return 37===t?"left":38===t?"up":39===t?"right":40===t?"down":void 0}addPressedButtons(t){this.pressedButtons[t]||(this.pressedButtons[t]=!0,this.pressedButtons.amount+=1)}getImageShiftX(){let t=this.speed;return this.pressedButtons.left&&(t=-t),this.pressedButtons.left||this.pressedButtons.right?this.pressedButtons.up||this.pressedButtons.down?t/Math.sqrt(2):t:0}getImageShiftY(){let t=this.speed;return this.pressedButtons.up&&(t=-t),this.pressedButtons.up||this.pressedButtons.down?this.pressedButtons.left||this.pressedButtons.right?t/Math.sqrt(2):t:0}stopHandleInput(t){const e=t.keyCode,i=this.getButtonDirection(e);37!==e&&38!==e&&39!==e&&40!==e||(this.setState("stay"),this.removePressedButtons(i))}removePressedButtons(t){this.pressedButtons.amount-=1,this.pressedButtons[t]=!1}clearCache(){this.pressedButtons.up=!1,this.pressedButtons.right=!1,this.pressedButtons.down=!1,this.pressedButtons.left=!1,this.pressedButtons.amount=0}setState(t){this.state=r.get(t),super.setState(this.state)}}class m extends n{constructor(t,...e){super(...e),this.imageReverse=!0,this.spriteDirectionChangeable=!0,this.maxHealth=this.healthPoints,this.taskTheme=t}getFullName(){return`${this.name.get("firstName")} ${this.name.get("surname")} ${this.name.get("lastName")}`}renderImage(){this.renderBodyParts("legs",0,0),this.renderBodyParts("body",0,-23),this.renderBodyParts("weapon",-35,-33),this.renderBodyParts("head",0,-57)}renderBodyParts(t,e,i){const s=this.appearance.get(t);this.spritePosition=s.firstSpritePosition,this.framesAmount=s.framesAmount,this.setImagePosition(e,i),super.renderImage(),this.setImagePosition(-e,-i)}moveToPosition(...t){this.imagePosition[0]<-150&&(this.imagePosition[0]=this.canvas.width+200,this.isMoving=!1),super.moveToPosition(...t)}}class p extends s{constructor(t,e,...i){super(...i),this.heal=t,this.speed=e,this.framesPerSecond=10,this.active=!1}setState(t){this.currentState=t,this.spritePosition=t.firstSpritePosition.slice(),this.spriteSize=t.spriteSize.slice(),this.framesAmount=t.framesAmount,this.imageWidth=t.imageSize[0],this.imageHeight=t.imageSize[1],this.animationDelay=t.animationDelay,this.spriteRepeat=t.repeat}}function u(t,e=0){return e+Math.floor(Math.random()*(t-e))}function g(t){const e=new Map;return t.forEach((t,i)=>{e.set(i,t[u(t.length)])}),e}function f(t){const e=t.length;t.forEach((i,s)=>{const n=u(e);[t[s],t[n]]=[t[n],t[s]]})}class v{constructor(t,e,i=[]){this.canvas=t,this.canvasContext=this.canvas.getContext("2d"),this.player=e,this.enemies=i,this.hasHandlers=!1}render(){this.renderBackground(),this.renderCharInfo(),this.enemies.concat(this.player).sort((t,e)=>t.imagePosition[1]+t.imageHeight-(e.imagePosition[1]+e.imageHeight+35)).forEach(t=>{t.renderImage()})}renderCharInfo(){const t=this.canvas.width/2-100;this.renderText(this.player.name,55,50,t-10),this.renderHealthScale(this.player.healthPoints,t,50,70,this.player.maxHealth),this.renderText(this.player.healthPoints,55,90,t-10)}renderBackground(){const t=new Image;t.src="images/bg.jpg",this.canvasContext.drawImage(t,0,0,this.canvas.width,this.canvas.height)}renderText(t,e,i,s,n="#fff",r="left",a="20px serif"){this.canvasContext.font=a,this.canvasContext.fillStyle=n,this.canvasContext.textAlign=r,this.canvasContext.fillText(t,e,i,s)}renderHealthScale(t,e,i,s,n){this.canvasContext.fillStyle="#f00",this.canvasContext.fillRect(i,s,e,30),this.canvasContext.fillStyle="#080",this.canvasContext.fillRect(i,s,e*t/n,30)}playAudio(t,e=1){const i=new Audio(t);i.volume=+e,i.play()}}i(7);class y{constructor(t,e=[]){this.heading=t,this.links=e,this.selectedElementIndex=0}addHandlers(){document.addEventListener("keydown",this.selectElement)}removeHandlers(){document.removeEventListener("keydown",this.selectElement)}bindThis(){this.selectElement=this.selectElement.bind(this)}selectElement(t){const e=t.keyCode;38===e?(this.selectedElementIndex-=1,this.selectedElementIndex<0&&(this.selectedElementIndex=this.elements.length-1),this.elements[this.selectedElementIndex].focus()):40===e?(this.selectedElementIndex+=1,this.selectedElementIndex>this.elements.length-1&&(this.selectedElementIndex=0),this.elements[this.selectedElementIndex].focus()):13===e&&(this.targetId=this.elements[this.selectedElementIndex].dataset.id,this.removeHandlers(),this.component.remove())}getTargetId(){return this.targetId}isSelected(){return!!this.targetId}render(){const t=this.createElement("div","nav"),e=this.createElement("h2","nav-header",this.heading),i=this.createElement("ul","nav-list");this.links.forEach((t,e)=>{const s=this.createElement("li","nav-item"),n=this.createElement("button","link-item",t);n.innerHTML=t,n.setAttribute("data-id",e),s.appendChild(n),i.appendChild(s)}),t.appendChild(e),t.appendChild(i),this.component.appendChild(t),document.body.appendChild(this.component),this.elements=this.component.querySelectorAll(".link-item"),this.elements[this.selectedElementIndex].focus()}createElement(t,e,i){const s=document.createElement(t);return s.classList.add(e),i&&(s.innerHTML=i),s}init(){this.component=this.createElement("div","nav-wrapper"),this.bindThis(),this.addHandlers(),this.render()}}i(4);class b{constructor(){this.solved=!1}createAllElements(){this.component=this.createElement("div","task-block"),this.wrapper=this.createElement("div","task-wrapper"),this.header=this.createElement("h2","task-header","Реши задачу:")}createElement(t,e,i){const s=document.createElement(t);return s.classList.add(e),i&&(s.innerHTML=i),s}render(){this.createAllElements()}isCorrect(){return this.solution===this.correctSolution}isSolved(){return this.solved}remove(){this.wrapper.remove()}init(){this.render()}}const w=[class extends b{constructor(){super(),this.solved=!1}createAllElements(){this.component=this.createElement("div","task-block"),this.wrapper=this.createElement("div","task-wrapper"),this.header=this.createElement("h2","task-header","Реши задачу:"),this.text=this.createElement("div","task-text",`${this.firstNumber} ${this.operator} ${this.secondNumber} = `),this.form=this.createElement("form","solution"),this.input=this.createElement("input","solution-input"),this.input.classList.add("num-solution-input")}addHandlers(){this.form.addEventListener("submit",this.submitAnswer.bind(this)),this.form.addEventListener("keydown",this.enterSolution.bind(this))}submitAnswer(t){if(""===this.input.value?this.solution=NaN:this.solution=Number(this.input.value),this.isCorrect()){this.input.classList.add("correct");const t=this.createElement("div","solution-correct","Правильно!");this.component.appendChild(t),this.input.setAttribute("disabled","disabled")}else{this.input.classList.add("wrong");const t=this.createElement("div","solution-wrong",`Неправильно! Правильный ответ: ${this.correctSolution}`);this.component.appendChild(t),this.input.setAttribute("disabled","disabled")}this.solved=!0,t.preventDefault()}enterSolution(t){const e=t.keyCode;46===e||8===e||13===e||27===e||e>=35&&e<=39||(e<48||e>57)&&(e<96||e>105)&&t.preventDefault()}render(){this.createAllElements(),this.form.appendChild(this.input),this.text.appendChild(this.form),this.component.appendChild(this.header),this.component.appendChild(this.text),this.wrapper.appendChild(this.component),document.body.appendChild(this.wrapper),this.input.focus(),this.addHandlers()}init(){const t=["+","-","x","&#247;"];this.operator=t[u(t.length)],"+"===this.operator?(this.firstNumber=u(100),this.secondNumber=u(100),this.correctSolution=this.firstNumber+this.secondNumber):"-"===this.operator?(this.firstNumber=u(100),this.secondNumber=u(this.firstNumber),this.correctSolution=this.firstNumber-this.secondNumber):"x"===this.operator?(this.firstNumber=u(10),this.secondNumber=u(10),this.correctSolution=this.firstNumber*this.secondNumber):(this.secondNumber=u(10,1),this.firstNumber=this.secondNumber*u(20),this.correctSolution=this.firstNumber/this.secondNumber),this.render()}},class extends b{constructor(){super(),this.decimalsAmount=2,this.solved=!1,this.decimals={},this.buttons=[],this.selectedElementIndex=0}addHandlers(){document.addEventListener("keydown",this.selectElement),this.form.addEventListener("submit",this.submitAnswer)}removeHandlers(){document.removeEventListener("keydown",this.selectElement)}bindThis(){this.selectElement=this.selectElement.bind(this),this.submitAnswer=this.submitAnswer.bind(this)}selectElement(t){const e=t.keyCode;37===e?(this.selectedElementIndex-=1,this.selectedElementIndex<0&&(this.selectedElementIndex=this.buttons.length-1),this.buttons[this.selectedElementIndex].focus()):39===e&&(this.selectedElementIndex+=1,this.selectedElementIndex>this.buttons.length-1&&(this.selectedElementIndex=0),this.buttons[this.selectedElementIndex].focus())}createAllElements(){this.component=this.createElement("div","task-block"),this.wrapper=this.createElement("div","task-wrapper"),this.header=this.createElement("h2","task-header","Выбери большее число:"),this.form=this.createElement("form","solution"),this.values.forEach(t=>{const e=this.createElement("button","decimal");e.innerHTML=`${this.decimals[t][0]} / ${this.decimals[t][1]}`,this.buttons.push(e),this.form.appendChild(e)})}submitAnswer(t){const e=document.activeElement;if(e.classList.contains("decimal")&&!this.isSolved()){if(this.solution=e.innerHTML,this.isCorrect()){e.classList.add("correct");const t=this.createElement("div","solution-correct","Правильно!");this.component.appendChild(t)}else{e.classList.add("wrong");const t=this.createElement("div","solution-wrong",`Неправильно! Правильный ответ: ${this.correctSolution}`);this.component.appendChild(t)}this.removeHandlers(),this.solved=!0,t.preventDefault()}else t.preventDefault()}render(){this.createAllElements(),this.component.appendChild(this.header),this.component.appendChild(this.form),this.wrapper.appendChild(this.component),document.body.appendChild(this.wrapper),this.buttons[this.selectedElementIndex].focus(),this.addHandlers()}addDecimals(t){let e=0;for(;e<t;){const t=[u(10,1),u(30,10)];this.decimals[t[0]/t[1]]||(this.decimals[t[0]/t[1]]=t,e++)}}init(){this.addDecimals(this.decimalsAmount),this.values=Object.keys(this.decimals);const t=Math.max.apply(null,this.values);this.correctSolution=`${this.decimals[t][0]} / ${this.decimals[t][1]}`,this.bindThis(),this.render()}}];const x=[{original:"cat",translation:"кот, кошка, котик"},{original:"dog",translation:"собака, собачка, пёс, пёсик, пес, песик"},{original:"mouse",translation:"мышь, мышка"},{original:"bird",translation:"птица, птичка"},{original:"fish",translation:"рыба, рыбка"},{original:"elephant",translation:"слон, слоник"},{original:"red",translation:"красный"},{original:"blue",translation:"синий"},{original:"green",translation:"зеленый"},{original:"yellow",translation:"жёлтый, желтый"},{original:"white",translation:"белый"},{original:"black",translation:"чёрный, черный"},{original:"family",translation:"семья"},{original:"mother",translation:"мама, мать"},{original:"father",translation:"папа, отец"},{original:"daughter",translation:"дочь, дочка"},{original:"son",translation:"сын, сынок"},{original:"girl",translation:"девочка"},{original:"boy",translation:"мальчик"},{original:"name",translation:"имя"},{original:"pupil",translation:"ученик"},{original:"ball",translation:"мяч, мячик"},{original:"tree",translation:"дерево"},{original:"plant",translation:"растение"},{original:"flower",translation:"цветок, цветочек"},{original:"car",translation:"машина, машинка, тачка"},{original:"ship",translation:"корабль, кораблик, лодка, лодочка"},{original:"bus",translation:"автобус"},{original:"airplane",translation:"самолёт, самолётик, самолет, самолетик"},{original:"shirt",translation:"рубашка, рубаха"},{original:"tea",translation:"чай"},{original:"coffee",translation:"кофе"},{original:"juice",translation:"сок"},{original:"soap",translation:"мыло"},{original:"brush",translation:"щётка, щетка, кисть"},{original:"bed",translation:"кровать"},{original:"school",translation:"школа"},{original:"home",translation:"дом"},{original:"river",translation:"река"},{original:"lake",translation:"озеро"},{original:"island",translation:"остров"},{original:"sea",translation:"море"},{original:"ocean",translation:"океан"},{original:"dolphin",translation:"дельфин"},{original:"pencil",translation:"карандаш"},{original:"cookie",translation:"печенье"},{original:"milk",translation:"молоко"},{original:"cheese",translation:"сыр"},{original:"cup",translation:"кружка, чашка"},{original:"spoon",translation:"ложка"},{original:"fork",translation:"вилка"},{original:"kitten",translation:"котёнок, котенок"},{original:"puppy",translation:"щенок"}],S=[class extends b{constructor(){super(),this.solved=!1}createAllElements(){this.component=this.createElement("div","task-block"),this.wrapper=this.createElement("div","task-wrapper"),this.header=this.createElement("h2","task-header","Введи перевод:"),this.text=this.createElement("div","task-text",`${this.word.original}`),this.form=this.createElement("form","solution"),this.input=this.createElement("input","solution-input"),this.input.classList.add("text-solution-input")}addHandlers(){this.form.addEventListener("submit",this.submitAnswer.bind(this))}submitAnswer(t){if(this.solution=this.input.value.trim().toLowerCase(),this.isCorrect()){this.input.classList.add("correct");const t=this.createElement("div","solution-correct","Правильно!");this.component.appendChild(t),this.input.setAttribute("disabled","disabled")}else{this.input.classList.add("wrong");const t=this.createElement("div","solution-wrong",`Неправильно! Правильный ответ: ${this.correctSolution[0]}`);this.component.appendChild(t),this.input.setAttribute("disabled","disabled")}this.solved=!0,t.preventDefault()}render(){this.createAllElements(),this.form.appendChild(this.input),this.text.appendChild(this.form),this.component.appendChild(this.header),this.component.appendChild(this.text),this.wrapper.appendChild(this.component),document.body.appendChild(this.wrapper),this.input.focus(),this.addHandlers()}isCorrect(){return this.correctSolution.some(t=>t===this.solution)}init(){this.word=x[u(x.length)],this.correctSolution=this.word.translation.split(",").map(t=>t.trim()),this.render()}},class extends b{constructor(){super(),this.buttons=[],this.buttonWidth=50,this.currentZIndex=1,this.solved=!1}createAllElements(){this.component=this.createElement("div","task-block"),this.wrapper=this.createElement("div","task-wrapper"),this.header=this.createElement("h2","task-header","Собери слово внутри рамки:"),this.wordField=this.createElement("div","word-field"),this.cancelButton=this.createElement("button","cancel-button","Я не знаю ответ"),this.text=this.createElement("div","task-text","Используй мышь");let t=5;this.letters.forEach(e=>{const i=document.createElement("span");i.innerHTML=e,i.classList.add("letter"),i.draggable=!0,i.style.left=t+"px",i.style.top="5px",i.style.width=this.buttonWidth+"px",i.style.height=this.buttonWidth+"px";let s=u(210,150);i.style.backgroundColor=`rgb(240, ${s}, 0)`,this.buttons.push(i),this.wordField.style.width=this.buttonWidth*this.buttons.length+20+"px",this.wordField.style.height=this.buttonWidth+20+"px",this.wordField.appendChild(i),t+=this.buttonWidth})}addHandlers(){document.addEventListener("mousedown",this.takeLetter),document.addEventListener("mouseup",this.dropLetter),document.addEventListener("dragstart",t=>{t.preventDefault()}),this.cancelButton.addEventListener("click",this.cancel)}removeHandlers(){document.removeEventListener("mousedown",this.takeLetter),document.removeEventListener("mouseup",this.dropLetter),this.cancelButton.removeEventListener("click",this.cancel)}bindThis(){this.takeLetter=this.takeLetter.bind(this),this.dropLetter=this.dropLetter.bind(this),this.moveLetter=this.moveLetter.bind(this),this.cancel=this.cancel.bind(this)}takeLetter(t){this.target=t.target,this.target.style.zIndex=this.currentZIndex,this.target.classList.contains("letter")&&document.addEventListener("mousemove",this.moveLetter)}moveLetter(t){const e=this.wordField.getBoundingClientRect();this.target.style.left=t.clientX-e.left-this.target.offsetWidth/2+"px",this.target.style.top=t.clientY-e.top-this.target.offsetHeight/2+"px"}dropLetter(t){if(document.removeEventListener("mousemove",this.moveLetter),this.currentZIndex+=1,this.isInsideField()&&(this.buttons.sort((t,e)=>parseInt(t.style.left)-parseInt(e.style.left)),this.solution="",this.buttons.forEach(t=>{this.solution+=t.innerHTML}),this.isCorrect())){this.removeHandlers(),this.wordField.classList.add("correct");let t=5;this.buttons.forEach((e,i)=>{e.style.left=t+"px",e.style.top="5px",e.style.backgroundColor="#080",e.innerHTML=this.correctSolution[i],t+=this.buttonWidth}),this.solved=!0}}isInsideField(){return this.buttons.every(t=>parseInt(t.style.left)>=0&&parseInt(t.style.left)<=parseInt(this.wordField.style.width)-this.buttonWidth&&parseInt(t.style.top)>=0&&parseInt(t.style.top)<=parseInt(this.wordField.style.height)-this.buttonWidth)}cancel(){this.wordField.classList.add("wrong");let t=5;this.buttons.forEach((e,i)=>{e.style.left=t+"px",e.style.top="5px",e.style.backgroundColor="#d00",e.innerHTML=this.correctSolution[i],t+=this.buttonWidth}),this.removeHandlers(),this.solved=!0}render(){this.component.appendChild(this.header),this.component.appendChild(this.text),this.component.appendChild(this.wordField),this.component.appendChild(this.cancelButton),this.wrapper.appendChild(this.component),document.body.appendChild(this.wrapper)}init(){const t=x[u(x.length)];for(this.correctSolution=t.original,this.letters=this.correctSolution.split("");this.correctSolution===this.letters.join("");)f(this.letters);this.createAllElements(),this.bindThis(),this.addHandlers(),this.render()}},class extends b{constructor(){super(),this.choicesAmount=3,this.solved=!1,this.choices=[],this.buttons=[],this.selectedElementIndex=0}addHandlers(){document.addEventListener("keydown",this.selectElement),this.form.addEventListener("submit",this.submitAnswer.bind(this))}removeHandlers(){document.removeEventListener("keydown",this.selectElement)}bindThis(){this.selectElement=this.selectElement.bind(this),this.submitAnswer=this.submitAnswer.bind(this)}createAllElements(){this.component=this.createElement("div","task-block"),this.wrapper=this.createElement("div","task-wrapper"),this.header=this.createElement("h2","task-header","Выбери правильный перевод:"),this.text=this.createElement("div","task-word",`${this.word.original}`),this.form=this.createElement("form","solution"),this.choices.forEach(t=>{const e=this.createElement("button","choice-button");e.innerHTML=t,this.buttons.push(e),this.form.appendChild(e)})}selectElement(t){const e=t.keyCode;37===e?(this.selectedElementIndex-=1,this.selectedElementIndex<0&&(this.selectedElementIndex=this.buttons.length-1),this.buttons[this.selectedElementIndex].focus()):39===e&&(this.selectedElementIndex+=1,this.selectedElementIndex>this.buttons.length-1&&(this.selectedElementIndex=0),this.buttons[this.selectedElementIndex].focus())}submitAnswer(t){const e=document.activeElement;if(e.classList.contains("choice-button")&&!this.isSolved()){if(this.solution=e.innerHTML,this.isCorrect()){e.classList.add("correct");const t=this.createElement("div","solution-correct","Правильно!");this.component.appendChild(t)}else{e.classList.add("wrong");const t=this.createElement("div","solution-wrong",`Неправильно! Правильный ответ: ${this.correctSolution}`);this.component.appendChild(t)}this.removeHandlers(),this.solved=!0,t.preventDefault()}else t.preventDefault()}render(){this.createAllElements(),this.text.appendChild(this.form),this.component.appendChild(this.header),this.component.appendChild(this.text),this.wrapper.appendChild(this.component),document.body.appendChild(this.wrapper),this.buttons[this.selectedElementIndex].focus(),this.addHandlers()}addChoices(t){for(;this.choices.length<t;){const t=x[u(x.length)].translation.split(",")[0];t!==this.correctSolution&&-1===this.choices.indexOf(t)&&this.choices.push(t)}}init(){this.word=x[u(x.length)],this.correctSolution=this.word.translation.split(",")[0],this.addChoices(this.choicesAmount),this.choices.push(this.correctSolution),f(this.choices),this.bindThis(),this.render()}}];class E extends v{constructor(t,e,i){super(t,e,[i]),this.time=Date.now(),this.monster=i,this.spells=Array.from(l.keys()),this._enemyStartPosition=[this.canvas.width-200,this.canvas.height/2+100],this.states={playerTurn:!0,playerCast:!1,playerSpell:!1,enemyTurn:!1,enemyCast:!1,enemySpell:!1,finished:!1,fatality:!1,win:!1,lose:!1}}render(){super.render(),this.spell&&this.spell.renderImage(),this.cast&&this.cast.active&&this.cast.renderImage(),this.renderCharInfo(),this.states.playerTurn&&Date.now()-this.time>1e3?this.renderPlayerTurn():this.states.playerCast&&Date.now()-this.time>500?this.renderSpellCast():this.states.playerSpell&&Date.now()-this.time>800?this.renderSpell():this.states.enemyTurn&&Date.now()-this.time>500?("miss"===this.player.state.action&&this.cast.currentState!==d.get("hit")&&(this.cast.setState(d.get("hit")),this.playAudio("audio/explode.ogg","0.5"),this.cast.imagePosition[0]=this.player.imagePosition[0]-this.player.imageWidth/2,this.cast.imagePosition[1]=this.player.imagePosition[1]-this.player.imageHeight/2),Date.now()-this.time>1e3&&(this.cast.active=!1,this.renderEnemyTurn()),this.spellNav=null):this.states.enemyCast&&Date.now()-this.time>1e3?this.renderEnemyCast():this.states.enemySpell&&Date.now()-this.time>500?this.renderEnemySpell():this.states.fatality&&Date.now()-this.time>1e3?(this.spell=null,this.cast.active=!1,this.time=Date.now(),this.states.fatality=!1,this.states.finished=!0):this.states.finished&&Date.now()-this.time>1e3&&(this.player.setState("stay"),0===this.monster.healthPoints?(this.renderText("Победа!",this.canvas.width/2,this.canvas.height/2,this.canvas.width,"#ffd700","center","32px serif"),Date.now()-this.time>2e3&&(this.states.win=!0)):0===this.player.healthPoints&&(this.renderText("Игра окончена!",this.canvas.width/2,this.canvas.height/2,this.canvas.width,"#ffd700","center","32px serif"),Date.now()-this.time>2e3&&(this.states.lose=!0)))}renderCharInfo(){const t=this.canvas.width/2-100;super.renderCharInfo(),this.renderText(this.monster.getFullName(),this.canvas.width-55,50,t-10,"#fff","right"),this.renderHealthScale(this.monster.healthPoints,t,this.canvas.width-t-50,70,this.monster.maxHealth),this.renderText(this.monster.healthPoints,this.canvas.width-55,90,t-10,"#fff","right")}renderSpellNav(){this.spellNav=new y("Выбери заклинание:",this.spells),this.spellNav.init()}renderTaskWindow(){let t;t="math"===this.monster.taskTheme?w[u(w.length)]:S[u(S.length)],this.task=new t,this.task.init()}renderPlayerTurn(){this.player.setState("aim"),this.cast.active=!0,this.spell=null,this.cast.setState(d.get("aim")),this.cast.imagePosition[0]=this.player.imagePosition[0]+this.player.imageWidth-this.cast.imageWidth/2,this.cast.imagePosition[1]=this.player.imagePosition[1]+this.player.imageHeight-this.cast.imageHeight/2,!this.spellNav&&Date.now()-this.time>500?this.renderSpellNav():this.spellNav&&this.spellNav.isSelected()&&!this.task&&this.renderTaskWindow(),this.task&&this.task.isSolved()&&(this.task.isCorrect()?this.playAudio("audio/correct.ogg","0.1"):this.playAudio("audio/wrong.ogg","0.2"),this.states.playerTurn=!1,this.states.playerCast=!0,this.time=Date.now())}renderSpellCast(){this.task.isCorrect()?(this.player.setState("hit"),this.cast.setState(d.get("success")),"0"===this.spellNav.targetId?this.cast.move([this.monster.imagePosition[0],this.monster.imagePosition[1]-30]):"1"===this.spellNav.targetId?this.cast.move([this.monster.imagePosition[0]+this.monster.imageWidth/2-this.cast.imageWidth-2+30,180]):"2"===this.spellNav.targetId&&this.cast.move([this.canvas.width/2,-100]),this.playAudio("audio/kick.ogg","0.3"),this.playAudio("audio/cast.ogg","0.3"),this.states.playerSpell=!0):(this.player.setState("miss"),this.cast.setState(d.get("failure")),this.playAudio("audio/kick.ogg","0.3"),this.states.enemyTurn=!0),this.task.remove(),this.task=null,this.time=Date.now(),this.states.playerCast=!1}renderSpell(){this.player.setState("stay"),this.cast.active=!1,this.playAudio("audio/explode.ogg","0.5");const t=this.spellNav.targetId,e=l.get(this.spells[t]),i=[];"0"===t?(i[0]=this.monster.imagePosition[0]+this.monster.imageWidth/2-e.imageSize[0]/2,i[1]=this.monster.imagePosition[1]-this.monster.imageHeight/2-e.imageSize[1]/4):"1"===t?(i[0]=this.monster.imagePosition[0]+this.monster.imageWidth/2-e.imageSize[0]/2,i[1]=180,this.cast.active=!0,this.cast.setState(d.get("hit")),this.cast.imagePosition[0]=this.monster.imagePosition[0]+this.monster.imageWidth/2-this.cast.imageWidth/2+20,this.cast.imagePosition[1]=this.cast.imagePosition[1]-this.cast.imageHeight/2):"2"===t&&(i[0]=this.player.imagePosition[0],i[1]=this.player.imagePosition[1]),this.playAudio(e.audio,"0.5"),this.spell=new p(e.heal,e.speed,this.canvas,e.url,e.imageSize[0],e.imageSize[1],i,e.spriteSize,e.firstSpritePosition,e.animationDelay,e.framesAmount,e.repeat);let s=this.monster.healthPoints;if(!0===this.spell.heal){const t=u(30,20);this.player.setHealthPoints(t)}else{const t=u(60,30);s-=t,this.monster.setHealthPoints(-t)}this.states.playerSpell=!1,this.time=Date.now(),s<=0?this.states.fatality=!0:this.states.enemyTurn=!0}renderEnemyTurn(){"stay"!==this.player.stateAction&&this.player.setState("stay"),this.states.enemyTurn=!1,this.states.enemyCast=!0}renderEnemyCast(){const t=l.get(this.spells[0]);this.spell=new p(t.heal,t.speed,this.canvas,t.url,t.imageSize[0],t.imageSize[1],[this.monster.imagePosition[0]+this.monster.imageWidth-t.imageSize[0]/2,this.monster.imagePosition[1]-this.monster.imageHeight/2],t.spriteSize,[0,0],t.animationDelay,t.framesAmount,t.repeat),this.spell.move([this.player.imagePosition[0]+this.player.imageWidth/2-this.spell.imageWidth/2,this.player.imagePosition[1]]),this.time=Date.now(),this.states.enemyCast=!1,this.states.enemySpell=!0}renderEnemySpell(){this.spell.spritePosition=[0,115],this.playAudio("audio/explosion.ogg","0.5");const t=u(30,10);this.player.setHealthPoints(-t),this.time=Date.now(),this.states.enemySpell=!1,this.player.healthPoints-t<=0?this.states.finished=!0:this.states.playerTurn=!0}isFinished(){return this.states.win}isGameOver(){return this.states.lose}getNext(t){return null}init(){this.player.setState("aim"),this.player.imageReverse=!1,this.player.imagePosition=[150,this.canvas.height/2+80],this.monster.imagePosition=this._enemyStartPosition.slice();const t=d.get("aim"),e=[];e[0]=this.player.imagePosition[0]+this.player.imageWidth-t.imageSize[0]/2,e[1]=this.player.imagePosition[1]+this.player.imageHeight-t.imageSize[1]/2;const i=t.speed;this.cast=new p(!1,i,this.canvas,t.url,t.imageSize[0],t.imageSize[1],e,t.spriteSize,t.firstSpritePosition,t.animationDelay,t.framesAmount,t.repeat),this.cast.active=!0}}class P extends v{addHandlers(){document.addEventListener("keydown",this.player.handleInput),document.addEventListener("keyup",this.player.stopHandleInput),this.hasHandlers=!0}bindThis(){this.player.handleInput=this.player.handleInput.bind(this.player),this.player.stopHandleInput=this.player.stopHandleInput.bind(this.player)}removeHandlers(){document.removeEventListener("keydown",this.player.handleInput),document.removeEventListener("keyup",this.player.stopHandleInput),this.hasHandlers=!1,this.player.clearCache()}render(){super.render(),this.enemies.forEach(t=>{const e=t.imagePosition[0]+t.imageWidth/2,i=t.imagePosition[1]-t.imageHeight/2;let s="";s="math"===t.taskTheme?"Математика":"Английский",this.canvasContext.fillStyle="rgba(0, 0, 0, 0.5)",this.canvasContext.fillRect(e-55,i-40,1.5*t.imageWidth,30),this.renderText(s,e,i-20,1.5*t.imageWidth,"#fff","center","16px serif")})}isFinished(){const t=this.player.imagePosition[0],e=this.player.imagePosition[0]+this.player.imageWidth,i=this.player.imagePosition[1],s=this.player.imagePosition[1]+this.player.imageHeight;return this.enemies.forEach(n=>{const r=n.imagePosition[0],a=n.imagePosition[0]+n.imageWidth,o=n.imagePosition[1],h=n.imagePosition[1]+n.imageHeight;e<r||t>a||i>h-100||s<o+30||(this.attackedMonster=n)}),this.attackedMonster}getNext(){const t=this.attackedMonster;return this.attackedMonster=null,new E(this.canvas,this.player,t)}init(){this.bindThis(),this.addHandlers()}}class C{createElement(t,e,i){const s=document.createElement(t);return s.classList.add(e),i&&(s.innerHTML=i),s}createAllElements(){this.component=this.createElement("div","register-block"),this.wrapper=this.createElement("div","register-wrapper"),this.header=this.createElement("h2","register-header","Введи имя:"),this.form=this.createElement("form","form"),this.input=this.createElement("input","name-input"),this.input.required=!0}addHandlers(){this.form.addEventListener("submit",this.submitAnswer.bind(this))}submitAnswer(t){this.name=this.input.value,t.preventDefault()}getName(){return this.name}remove(){this.wrapper.remove()}render(){this.createAllElements(),this.form.appendChild(this.input),this.component.appendChild(this.header),this.component.appendChild(this.form),this.wrapper.appendChild(this.component),document.body.appendChild(this.wrapper),this.input.focus(),this.addHandlers()}init(){this.render()}}class A{constructor(t,e){this.name=t,this.level=e,this.score={name:this.name,level:this.level}}render(){this.table=this.createElement("table","result-table"),this.wrapper=this.createElement("div","result-wrapper");const t=this.createElement("tr","result-heading");t.insertCell(0).innerHTML="Место",t.insertCell(1).innerHTML="Имя",t.insertCell(2).innerHTML="Уровень",this.table.appendChild(t),this.results.forEach((t,e)=>{const i=this.createElement("tr","result-row"),s=e+1;t===this.score&&i.classList.add("current-score"),i.insertCell(0).innerHTML=s,i.insertCell(1).innerHTML=t.name,i.insertCell(2).innerHTML=t.level,this.table.appendChild(i)}),this.wrapper.appendChild(this.table),document.body.appendChild(this.wrapper)}createElement(t,e,i){const s=document.createElement(t);return s.classList.add(e),i&&(s.innerHTML=i),s}remove(){this.wrapper.remove()}init(){this.results=JSON.parse(window.localStorage.getItem("results")),this.results||(this.results=[]),this.results.push(this.score),this.results.sort((t,e)=>e.level-t.level),this.results.splice(10),window.localStorage.setItem("results",JSON.stringify(this.results)),this.render()}}class k{constructor(t,e,i){this.canvas=t,this.canvasContext=this.canvas.getContext("2d"),this.player=e,this.level=i,this.enemies=[]}render(){this.mode?(this.mode.render(),this.renderText(`Уровень ${this.level}`,this.canvas.width/2,50,this.canvas.width,"#ffd700","center","32px serif"),this.mode.isFinished()&&(this.mode.hasHandlers&&this.mode.removeHandlers(),this.mode=this.mode.getNext(this.enemies),this.mode&&this.mode.init())):this.finished=!0}renderText(t,e,i,s,n="#fff",r="left",a="20px serif"){this.canvasContext.font=a,this.canvasContext.fillStyle=n,this.canvasContext.textAlign=r,this.canvasContext.fillText(t,e,i,s)}createMonster(t,e){const i=g(h),s=u(150,100),n=o.get("stay"),r=n.imageSize[0],l=n.imageSize[1],d=new m(e,g(a),i,s,this.canvas,"images/enemy-sprite.png",t,n,n.action,r,l,n.animationDelay,n.repeat,n.spriteSize);this.enemies.push(d)}isCompleted(){return this.finished}init(){this.createMonster([this.canvas.width-u(150,130),this.canvas.height-u(200,200)],"math"),this.createMonster([this.canvas.width-u(440,420),this.canvas.height-u(235,225)],"english"),this.mode=new P(this.canvas,this.player,this.enemies),this.mode.init()}}const I=new class{constructor(t){this.canvas=t,this.canvasContext=t.getContext("2d"),this.level=1}showRegister(){const t=new Image;if(t.src="images/start-bg.jpg",this.canvasContext.drawImage(t,0,0,this.canvas.width,this.canvas.height),this.registerWindow){if(this.registerWindow.getName()){this.name=this.registerWindow.getName(),this.registerWindow.remove(),this.registerWindow=null,this.music.pause();const t=[100,this.canvas.height-160],e=r.get("stay"),i=100;return this.player=new c(this.name,"Scrooge",i,this.canvas,"images/hero-sprite.png",t,e,e.action,e.imageSize[0],e.imageSize[1],e.animationDelay,e.repeat,e.spriteSize,e.firstSpritePosition,e.framesAmount),window.cancelAnimationFrame(this.loop),void this.startGame()}}else this.registerWindow=new C,this.registerWindow.init(),this.music=new Audio("audio/main-theme.mp3"),this.music.volume=.5,this.music.play();this.loop=window.requestAnimationFrame(this.showRegister.bind(this))}startGame(){this.render(),this.loop=window.requestAnimationFrame(this.startGame.bind(this)),this.isGameOver()&&window.cancelAnimationFrame(this.loop)}clearInfo(){this.stage=null,this.level=1}restartGame(){this.resultWindow.remove(),this.resultWindow=null,this.clearInfo(),this.showRegister(),document.removeEventListener("keydown",this.restartGame)}render(){if(this.stage)if(this.stage.isCompleted())this.level+=1,this.stage=null;else if(this.isGameOver()&&!this.resultWindow){const t=new Image;t.src="images/start-bg2.jpg";const e=new Audio("audio/death.mp3");e.volume=.3,e.play(),this.canvasContext.drawImage(t,0,0,this.canvas.width,this.canvas.height),this.resultWindow=new A(this.player.name,this.level),this.resultWindow.init(),this.restartGame=this.restartGame.bind(this),document.addEventListener("keydown",this.restartGame)}else this.stage.render();else{this.stage=new k(this.canvas,this.player,this.level),this.stage.init();const t=new Audio("audio/start-stage.mp3");t.volume=.3,t.play()}}isGameOver(){return 0===this.player.healthPoints}init(){this.showRegister()}}(document.querySelector("#gameCanvas")),L=new class{constructor(){this.resourceCache={},this.readyCallbacks=[]}load(t){Array.isArray(t)?t.forEach(t=>{this.loadUrl(t)}):this.loadUrl(url)}loadUrl(t){if(!this.resourceCache[t]){const e=new Image;e.addEventListener("load",()=>{this.resourceCache[t]=e,this.isReady()&&this.readyCallbacks.forEach(t=>t())}),this.resourceCache[t]=!1,e.src=t}}get(t){return this.resourceCache[t]}isReady(){let t=!0;for(let e in this.resourceCache)this.resourceCache.hasOwnProperty(e)&&!this.resourceCache[e]&&(t=!1);return t}onReady(t){this.readyCallbacks.push(t)}};L.load(["images/hero-sprite.png","images/enemy-sprite.png","images/castSpell.png","images/lightning.png","images/bg.jpg","images/breath.png","images/heal.png","images/start-bg.jpg","images/start-bg2.jpg"]),L.onReady(I.init.bind(I))},function(t,e,i){(t.exports=i(1)(!1)).push([t.i,"* {\r\n  margin: 0;\r\n}\r\n\r\n.task-wrapper {\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin: 0;\r\n  padding: 0;\r\n  background-color: rgba(100, 100, 100, 0.4);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.task-block {\r\n  display: flex;\r\n  position: relative;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  text-align: center;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n.task-header {\r\n  font-size: 30px;\r\n  padding: 10px;\r\n  color: #ffd700;\r\n}\r\n\r\n.task-text {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: stretch;\r\n  text-align: center;\r\n  margin: 0;\r\n  padding: 0;\r\n  color: #ffd700;\r\n  font-size: 20px;\r\n}\r\n\r\n.solution-input {\r\n  margin: 0 10px;\r\n  text-align: center;\r\n  border: none;\r\n  font-size: 18px;\r\n}\r\n\r\n.num-solution-input {\r\n  width: 50px;\r\n}\r\n\r\n.text-solution-input {\r\n  width: 150px;\r\n}\r\n\r\n.solution-correct,\r\n.solution-wrong {\r\n  position: absolute;\r\n  font-size: 20px;\r\n  font-weight: bold;\r\n  top: 100%;\r\n  padding: 10px;\r\n  box-sizing: border-box;\r\n  width: 100%;\r\n}\r\n\r\n.solution-correct {\r\n  color:#080;\r\n}\r\n\r\n.solution-wrong {\r\n  color:#d00;\r\n}\r\n\r\n.word-field {\r\n  border: 5px solid #ffd700;\r\n  position: relative;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.word-field.correct {\r\n  border: 5px solid #080;\r\n}\r\n\r\n.word-field.wrong {\r\n  border: 5px solid #d00;\r\n}\r\n\r\n.letter {\r\n  position: absolute;\r\n  background-color: #ffd700;\r\n  border: 0.1px solid #aaa;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-weight: bold;\r\n  font-size: 25px;\r\n}\r\n\r\n.letter:hover {\r\n  border: 0.1px solid #000;\r\n}\r\n\r\n.word-field.correct .letter,\r\n.word-field.wrong .letter {\r\n  border: none;\r\n}\r\n\r\n.letter:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n.cancel-button {\r\n  margin: 20px;\r\n  color: #ffd700;\r\n  font-size: 20px;\r\n  border: none;\r\n  background-color: transparent;\r\n}\r\n\r\n.cancel-button:hover {\r\n  cursor: pointer;\r\n  color: #f00;\r\n}\r\n\r\n.decimal, \r\n.choice-button {\r\n  margin: 0;\r\n  padding: 10px 30px;\r\n  color: #ffd700;\r\n  font-size: 20px;\r\n  border: none;\r\n  background-color: transparent;\r\n}\r\n\r\n.decimal:focus,\r\n.choice-button:focus {\r\n  background-color: #aaa;\r\n}\r\n\r\n.task-word {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: stretch;\r\n  flex-direction: column;\r\n  text-align: center;\r\n  font-weight: bold;\r\n  color: #ffd700;\r\n  font-size: 22px;\r\n}\r\n\r\n.correct,\r\n.decimal.correct,\r\n.choice-button.correct {\r\n  background-color: #080;\r\n  color: #fff;\r\n}\r\n\r\n.wrong,\r\n.decimal.wrong,\r\n.choice-button.wrong {\r\n  background-color: #d00;\r\n  color: #fff;\r\n}\r\n",""])},function(t,e,i){var s=i(3);"string"==typeof s&&(s=[[t.i,s,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i(0)(s,n);s.locals&&(t.exports=s.locals)},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,s=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var n,r=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?t:(n=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:s+r.replace(/^\.\//,""),"url("+JSON.stringify(n)+")")})}},function(t,e,i){(t.exports=i(1)(!1)).push([t.i,".nav-wrapper {\r\n  position: fixed;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin: 0;\r\n  padding: 0;\r\n  background-color: rgba(100, 100, 100, 0.4);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.nav {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  text-align: center;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n.nav-header {\r\n  font-size: 30px;\r\n  padding: 20px;\r\n  color: #ffd700;\r\n}\r\n\r\n.nav-list {\r\n  list-style: none;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: stretch;\r\n  text-align: center;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n.link-item {\r\n  margin: 0;\r\n  padding: 10px 30px;\r\n  color: #ffd700;\r\n  font-size: 20px;\r\n  border: none;\r\n  background-color: transparent;\r\n}\r\n\r\n.link-item:focus {\r\n  background-color: #aaa;\r\n}\r\n\r\n.nav-item {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}",""])},function(t,e,i){var s=i(6);"string"==typeof s&&(s=[[t.i,s,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};i(0)(s,n);s.locals&&(t.exports=s.locals)}]);